<!DOCTYPE html>
<html>
<head>
<title>Login - LiftOff</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin: 0;
    overflow: hidden;
    font-family: 'Segoe UI', sans-serif;
    background-color: #111827;
    color: #f3f4f6;
}
.dot {
    position: absolute;
    width: 3px;
    height: 3px;
    background: #9ca3af;
    border-radius: 50%;
    opacity: 0.6;
    animation: float linear infinite;
}
@keyframes float {
    0% { transform: translateY(0); }
    100% { transform: translateY(-200vh); }
}
.card {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(10px);
    padding: 40px;
    border-radius: 12px;
    width: 320px;
    text-align: center;
}
input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #374151;
    background: #1f2937;
    color: #f3f4f6;
    box-sizing: border-box;
}
button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 8px;
    border: none;
    background: #f3f4f6;
    color: #111827;
    cursor: pointer;
}
.small {
    font-size: 13px;
    margin-top: 15px;
    color: #9ca3af;
    cursor: pointer;
    text-align: center;
    width: 100%;
}
.small:hover {
    text-decoration: underline;
}
</style>
</head>

<body>

<script>
    const API_BASE = 'http://localhost:5000/api';
// floating dots
for(let i=0;i<120;i++){
    let dot=document.createElement("div");
    dot.className="dot";
    dot.style.left=Math.random()*100+"vw";
    dot.style.top=Math.random()*200+"vh";
    dot.style.animationDuration=(20+Math.random()*15)+"s";
    document.body.appendChild(dot);
}

// --- Local login function ---
function loginUser() {
    const input = document.getElementById("loginInput");
    const password = document.getElementById("loginPassword");

    const savedUser = JSON.parse(localStorage.getItem("liftoffUser"));

    if (!savedUser) {
        alert("No account found. Please sign up.");
        return;
    }

    if (
        (input.value === savedUser.email ||
         input.value === savedUser.username) &&
        password.value === savedUser.password
    ) {
        window.location.href = "dashboard.html";
    } else {
        input.style.border = "1px solid red";
        password.style.border = "1px solid red";
    }
}

// --- Google One Tap / FedCM integration ---
function handleCredentialResponse(response) {
    // send ID token to backend for verification
    fetch(`${API_BASE}/verify_token`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({id_token: response.credential})
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // store user info locally for dashboard access
            localStorage.setItem('liftoffUser', JSON.stringify({
                email: data.email,
                username: data.username || '',
                token: response.credential, // optional, in case you need it
                timestamp: Date.now()       // optional, can use for expiry
            }));

            // auto redirect if token valid
            window.location.href = "/dashboard.html"; // make sure the file name matches
        } else {
            console.warn("Invalid token");
        }
    })
    .catch(err => console.error("Error verifying token:", err));
}


// initialize Google One Tap
window.onload = function() {
    google.accounts.id.initialize({
        client_id: '584317388297-coc5rmpfdls901ptlvm1rq7f9aselli7.apps.googleusercontent.com', 
        callback: handleCredentialResponse,
        auto_select: true,  // silent login if token exists
        cancel_on_tap_outside: false
    });
    google.accounts.id.prompt(); // shows prompt only if no token exists
}
</script>

<!-- Load Google Identity Services -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<div class="card">
    <h2>Login</h2>
    <input type="text" id="loginInput" placeholder="Email or Username">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="loginUser()">Login</button>
    <div class="small" onclick="window.location.href='signup.html'">
        Don't have an account? Sign Up
    </div>
</div>

</body>
</html>
